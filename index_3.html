<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" type="text/css" href="static/css/bootstrap.css">
        <link rel="stylesheet" type="text/css" href="static/css/slider.css">
        <link rel="stylesheet" type="text/css" href="static/css/image-box.css">
        <script type="text/javascript" src="static/js/jquery-1.11.1.js"></script>
        <script type="text/javascript" src="static/js/bootstrap.js"></script>
        <script type="text/javascript" src="static/js/slider.js"></script>
        <script type="text/javascript" src="static/js/image-box.js"></script>
        
        <script>
            var rowHeight;
            var imageDragged = null;
            var draggedForward = false;
            var imgArray = [];
            
            $(document).ready(function(){
                rowHeight = parseFloat(($(window).height() * 90 / 100) / 5);
                //console.log(rowHeight);
                var imageBoxObj = new ImageBox();
                imageBoxObj.createOuterContainer();
                for (var i = 0; i < 29; i++){
                    var imageBox = imageBoxObj.createImageBox();
                    imageBoxObj.outerContainer.append(imageBox);
                    var imPath = '../images/im' + (i + 1) + '.jpg';
                    imageBoxObj.loadImage(imPath, imageBox);
                    imageBoxObj.sliderArray[imageBoxObj.sliderArray.length - 1].initSlider();
                }
                
                $("body").on("mousedown", "img", function(event){
                    $(this).closest(".wrapper").addClass("border-glow");
                    $(this).closest(".wrapper").css("z-index", 2);
                    imageDragged = {};
                    imageDragged.image = $(this).closest(".wrapper");
                    imageDragged.xOffset = event.pageX - imageDragged.image.offset().left;
                    imageDragged.yOffset = event.pageY - imageDragged.image.offset().top;
                    
                    //console.log($(imgArray[0]).find("img").prop("src"));
                    $(".wrapper").each(function(index, value){
                        imgArray.push(value);
                        //console.log($(value).find("img").attr("src"));
                    });
                    console.log(imgArray.length);
                });
                
                $("body").on("mouseup", function(event){
                    if (sliderPressed === true){
                        //$(activeSlider.roller).trigger("mouseup");
                        activeSlider.releaseSlider();
                    }
                    if(imageDragged){
                        imageDragged.image.removeClass("border-glow");
                        
                        newX = imageDragged.image.offset().left;
                        newY = imageDragged.image.offset().top;
                        
                        var indexOfImageDragged = imgArray.indexOf(imageDragged.image[0]);
                        
                        console.log(indexOfImageDragged);
                        //console.log($(imgArray[6]).find("img").attr("src"));
                        $(".wrapper").each(function(index, value){
                            if (value === imageDragged.image[0]){
                                console.log(true);
                                draggedForward = true;
                                imgArray.splice(indexOfImageDragged, 1);
                            }
                            compareX = $(value).offset().left + $(value).width();
                            compareY = $(value).offset().top + $(value).height();
                            
                            if (newX <= compareX && newY <= compareY && value !== imageDragged.image[0]){
                                console.log("changed at " + index);
                                if (draggedForward == false){
                                    imgArray.splice(index, 0, imageDragged.image);
                                    imgArray.splice(indexOfImageDragged + 1, 1);
                                }
                                else{
                                    imgArray.splice(index - 1, 0, imageDragged.image);
                                    draggedForward = false;
                                }
                                
                                return false;
                            }
                            
                            
                        
                        });
                        //console.log($(imgArray[6]).find("img").attr("src"));
                        imageDragged.image.css("z-index", "auto");
                        imageDragged = null;
                        console.log(imgArray.length)
                        
                        imageBoxObj.outerContainer = null;
                        $(".outer-image-container").remove();
                        imageBoxObj.createOuterContainer();
                        
                        $.each(imgArray, function(index, value){
                            //$(value).removeClass("thumbnail").addClass("thumbnail");
                            //$(value).css("width", "auto").css("height", "auto");
                            //imageBoxObj.outerContainer.append($(value));
                            
                            var imageBox = imageBoxObj.createImageBox();
                            imageBox.append($(value).children().clone(true));
                            imageBoxObj.outerContainer.append(imageBox);
                            
                            //var imPath = $(value).find("img").attr("src");
                            //imageBoxObj.loadImage(imPath, imageBox);
                            
                            //console.log($(value).find("img").attr("src"));
                            console.log("123")
                            
                        });
                        
                        //imageBoxObj.outerContainer.removeClass("outer-image-container").addClass("outer-image-container");
                        
                        imgArray = [];
                        //$(this).find(".btn-close").hide();
                        //$(this).find(".slider-wrapper").hide();
                    }
                });
                
                $("body").on("mousemove", function(event){
                    if (sliderPressed === true){
                        activeSlider.dragSlider();
                    }
                    if(imageDragged){
                        
                        imageDragged.image.closest(".wrapper").offset({
                            left: event.pageX - imageDragged.xOffset,
                            top: event.pageY - imageDragged.yOffset
                            
                        });
                        
                    }
                    return false;
                });
                /*
                $(".wrapper").mouseenter(function(){
                    $(this).find(".btn-close").show();
                    $(this).find(".slider-wrapper").show();
                });
                
                $(".wrapper").mouseleave(function(){
                    $(this).find(".btn-close").hide();
                    $(this).find(".slider-wrapper").hide();
                });
                */
                //console.log(screen.availHeight);
                //console.log($(window).height());
                //console.log($(".outer-image-container").height());
            });
            
        </script>
    </head>

    <body>
        
    </body>

</html>